<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <title>RentalMetrics – UK Property Deal &amp; Yield Analysis Tool</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="container header-inner">
      <div>
        <h1>Rental Metrics<span class="domain-suffix">.co.uk</span></h1>
        <p class="subtitle">Free UK Property Deal &amp; Yield Analysis</p>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="mode-toggle-row">
      <div class="mode-toggle">
        <button type="button" class="mode-btn active" data-mode="analyser">Deal Analyser</button>
        <button type="button" class="mode-btn" data-mode="sdlt">SDLT Calculator Only</button>
      </div>
      <button type="button" id="darkModeToggle" class="dark-mode-toggle" title="Toggle dark mode">&#9790;</button>
    </div>
    <div class="layout">
      <section class="input-panel">
        <h2>Property Details</h2>
        <form id="dealForm" autocomplete="off">
          <div class="form-group">
            <label for="address">
              Address / Postcode
              <span class="tooltip" data-tip="Enter the property address or postcode for reference.">?</span>
            </label>
            <input type="text" id="address" placeholder="e.g. WF2">
          </div>

          <div class="form-group buyer-type-group">
            <label>
              Buyer Type
              <span class="tooltip" data-tip="Select whether this is an additional/investment property (higher SDLT) or a first-time buyer purchase (lower SDLT).">?</span>
            </label>
            <div class="buyer-type-toggle">
              <button type="button" class="buyer-type-btn active" data-buyer="investor">Investor</button>
              <button type="button" class="buyer-type-btn" data-buyer="ftb">First-Time Buyer</button>
            </div>
          </div>

          <div class="form-group analyser-only">
            <label for="dealReference">
              Deal Reference
              <span class="tooltip" data-tip="Give this deal a name to help identify it later, e.g. 'Beechwood with Mortgage'.">?</span>
            </label>
            <input type="text" id="dealReference" placeholder="e.g. house with mortgage" maxlength="60">
          </div>

          <div class="form-group">
            <label for="price">
              Asking Price (&pound;)
              <span class="tooltip" data-tip="The listed or agreed purchase price of the property.">?</span>
            </label>
            <input type="number" id="price" min="0" step="any" required placeholder="e.g. £200,000">
          </div>

          <div class="form-group analyser-only">
            <label for="monthlyRent">
              Expected Monthly Rent (&pound;)
              <span class="tooltip" data-tip="The rent you expect to receive each month from tenants.">?</span>
            </label>
            <input type="number" id="monthlyRent" min="0" step="any" required placeholder="e.g. £900">
          </div>

          <div class="form-group analyser-only">
            <label for="solicitorFees">
              Solicitor Fees (&pound;)
              <span class="tooltip" data-tip="Legal fees for the purchase. Default is &pound;1,500.">?</span>
            </label>
            <input type="number" id="solicitorFees" min="0" step="any" value="1500">
          </div>

          <h3 class="analyser-only">
            Additional Costs
            <span class="tooltip" data-tip="Add itemised costs such as refurb, repairs, decorating, EPC, EICR, surveys, etc.">?</span>
          </h3>

          <div id="costItemsList" class="analyser-only"></div>
          <button type="button" id="addCostItem" class="btn-add-item analyser-only">+ Add Cost Item</button>
          <div class="cost-total-row analyser-only">
            <span>Total Additional Costs:</span>
            <span id="costItemsTotal">&pound;0</span>
          </div>

          <h3 class="analyser-only">Yield Adjustments</h3>

          <div class="form-group analyser-only">
            <label for="voidAllowance">
              Void Allowance (%)
              <span class="tooltip" data-tip="Allowance for empty periods between tenants. 5% means rent is reduced by 5% across the year.">?</span>
            </label>
            <input type="number" id="voidAllowance" min="0" max="100" step="any" value="0" placeholder="e.g. 5">
          </div>

          <div class="form-group analyser-only">
            <label>
              Maintenance Allowance
              <span class="tooltip" data-tip="Ongoing repairs and maintenance allowance. Many investors budget 5-10% of rent. Switch between percentage of rent or a fixed annual amount.">?</span>
            </label>
            <div class="maintenance-toggle">
              <button type="button" class="maint-mode-btn active" data-maint="pct">% of Rent</button>
              <button type="button" class="maint-mode-btn" data-maint="fixed">&pound; per Year</button>
            </div>
            <div id="maintPctInput">
              <input type="number" id="maintenancePct" min="0" max="100" step="any" value="0" placeholder="e.g. 8">
            </div>
            <div id="maintFixedInput" style="display:none;">
              <input type="number" id="maintenanceFixed" min="0" step="any" value="0" placeholder="e.g. &pound;1,000">
            </div>
          </div>

          <h3 class="analyser-only">
            Monthly Running Costs
            <span class="tooltip" data-tip="Itemise your ongoing monthly costs (insurance, ground rent, service charge, etc). Letting agent fee and maintenance are separate below.">?</span>
          </h3>
          <div id="runningCostItemsList" class="analyser-only"></div>
          <button type="button" id="addRunningCostItem" class="btn-add-item analyser-only">+ Add Running Cost</button>
          <div class="cost-total-row analyser-only">
            <span>Total Monthly Running Costs:</span>
            <span id="runningCostItemsTotal">&pound;0</span>
          </div>

          <div class="form-group analyser-only">
            <label for="lettingAgentFee">
              Letting Agent Fee (%)
              <span class="tooltip" data-tip="Percentage of monthly rent charged by your letting/management agent. Tick the box to add 20% VAT on top.">?</span>
            </label>
            <div class="letting-agent-row">
              <input type="number" id="lettingAgentFee" min="0" max="100" step="any" placeholder="e.g. 10">
              <label class="toggle-checkbox vat-checkbox">
                <input type="checkbox" id="lettingAgentVat">
                <span class="toggle-checkbox-label">+ 20% VAT</span>
              </label>
            </div>
          </div>

          <div class="form-group analyser-only target-offer-group">
            <label>
              Target Offer Price
              <span class="tooltip" data-tip="Toggle to show/hide target offer price calculation in results.">?</span>
            </label>
            <div class="target-offer-toggle-row">
              <label class="toggle-switch">
                <input type="checkbox" id="showTargetOffer" checked>
                <span class="toggle-slider"></span>
              </label>
              <div class="form-group target-yield-input" id="targetYieldGroup">
                <label for="targetYield">
                  Target Yield (%)
                  <span class="tooltip" data-tip="Your desired net yield. The tool will calculate the maximum price to achieve this.">?</span>
                </label>
                <input type="number" id="targetYield" min="0" max="50" step="any" value="7.0">
              </div>
            </div>
          </div>

          <div class="form-group analyser-only purchase-type-group">
            <label>
              Purchase Type
              <span class="tooltip" data-tip="Select whether this is a cash purchase or a mortgage purchase. Mortgage adjusts yields based on your cash invested.">?</span>
            </label>
            <div class="purchase-type-toggle">
              <button type="button" class="purchase-type-btn active" data-purchase="cash">Cash Purchase</button>
              <button type="button" class="purchase-type-btn" data-purchase="mortgage">Mortgage</button>
            </div>
          </div>

          <div id="mortgageInputs" class="mortgage-fields analyser-only" style="display:none;">
            <div class="form-row">
              <div class="form-group half">
                <label for="depositAmount">
                  Deposit (&pound;)
                  <span class="tooltip" data-tip="The deposit amount you will put down. The rest will be the mortgage.">?</span>
                </label>
                <input type="number" id="depositAmount" min="0" step="any" placeholder="e.g. £40,000">
              </div>
              <div class="form-group half">
                <label for="interestRate">
                  Interest Rate (%)
                  <span class="tooltip" data-tip="Annual mortgage interest rate.">?</span>
                </label>
                <input type="number" id="interestRate" min="0" max="30" step="any" value="4.5">
              </div>
            </div>
            <div class="form-group">
              <label for="mortgageTerm">
                Mortgage Term (years)
                <span class="tooltip" data-tip="The length of the mortgage in years.">?</span>
              </label>
              <input type="number" id="mortgageTerm" min="1" max="40" step="1" value="25">
            </div>
            <div class="form-group">
              <label for="stressTestRate">
                Stress Test Rate (%)
                <span class="tooltip" data-tip="Checks affordability if interest rates rise. Lenders typically stress test at 6-7%.">?</span>
              </label>
              <input type="number" id="stressTestRate" min="0" max="30" step="any" value="7.0">
            </div>
            <button type="button" class="btn-mortgage-calc" id="mortgageCalcBtn">Calculate Mortgage</button>
            <div class="borrowing-summary" id="borrowingSummary" style="display:none;">
              <div class="borrowing-row">
                <span class="borrowing-label">Cash Deposit</span>
                <span class="borrowing-value" id="borrowingDeposit">&pound;0</span>
              </div>
              <div class="borrowing-row">
                <span class="borrowing-label">SDLT</span>
                <span class="borrowing-value" id="borrowingSDLT">&pound;0</span>
              </div>
              <div class="borrowing-row">
                <span class="borrowing-label">Solicitor Fees</span>
                <span class="borrowing-value" id="borrowingSolicitor">&pound;0</span>
              </div>
              <div class="borrowing-row borrowing-total">
                <span class="borrowing-label">Amount to Borrow</span>
                <span class="borrowing-value" id="borrowingAmount">&pound;0</span>
              </div>
            </div>
          </div>

          <button type="submit" class="btn-calculate analyser-only">Analyse Deal</button>
          <button type="button" id="sdltCalcBtn" class="btn-calculate sdlt-only">Calculate SDLT</button>
          <button type="button" id="startAgainBtn" class="btn-start-again analyser-only" style="display:none;">Start Again</button>
          <button type="button" id="savePdfBtn" class="btn-save-pdf analyser-only" style="display:none;" onclick="printReport()">Save as PDF</button>
        </form>
      </section>

      <section class="results-panel" id="resultsPanel">
        <div class="results-placeholder">
          <p>Enter property details and click <strong>Analyse Deal</strong> to see results.</p>
        </div>
      </section>
    </div>

    <section class="map-section" id="mapSection" style="display:none;">
      <h2>Location</h2>
      <div id="mapContainer"></div>
    </section>

    <section class="history-section analyser-only" id="historySection">
      <h2>Comparison History</h2>
      <div id="historyList"></div>
    </section>

    <div id="compareOverlay" class="compare-overlay" style="display:none;">
      <div class="compare-container">
        <div class="compare-header">
          <h2>Deal Comparison</h2>
          <div class="compare-header-buttons">
            <button type="button" class="btn-compare-pdf" onclick="downloadComparePdf()">Download PDF</button>
            <button type="button" class="compare-close" onclick="closeCompare()">&times;</button>
          </div>
        </div>
        <div class="compare-sort">
          <label>Sort by:</label>
          <select id="compareSortBy" onchange="renderCompareTable()">
            <option value="rating">Deal Rating</option>
            <option value="netYield">Net Yield</option>
            <option value="grossYield">Gross Yield</option>
            <option value="price">Price (Low to High)</option>
            <option value="rent">Rent (High to Low)</option>
          </select>
        </div>
        <div id="compareBody"></div>
      </div>
    </div>

    <div id="printReport" class="print-report"></div>

    <footer class="disclaimer">
      <p><strong>Disclaimer:</strong> These calculations are estimates only and do not constitute financial or tax advice. SDLT rates and thresholds can change. Always consult a qualified professional before making investment decisions. This tool covers England &amp; Northern Ireland only (not Scotland LBTT or Wales LTT).</p>
    </footer>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
